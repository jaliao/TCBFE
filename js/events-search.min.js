document.onreadystatechange=function(){"complete"==document.readyState&&app()};const startDate=".event-startDate",endDate=".event-endDate",grouptext=".bv-events-group-text";let grouptextword,card,eventlist,dateFormat,_groupscope,_grouptextscope,_containerscope,visibleCard,groupedCard,key=[];function formatingDate(e){let t=checkLocale();e.each((function(){let e=$(this),n=e.find(startDate),s=e.find(endDate),o=dateFormalizing(n.attr("data-time"),dateFormat,t),a=dateFormalizing(s.attr("data-time"),dateFormat,t);n.text(o),s.text(a);let l=dateFormalizing(n.attr("data-time"),"MMMYYYY",t);e.attr("data-months",l),e.find(".bv-card-open-time").addClass("formalized"),e.addClass("visible")}))}function setUpItem(){card=$(".bv-card"),dateFormat="HH:mm ddd, DD/MM/YYYY",eventlist=$(".bv-events-list-container"),_groupscope='<div class="bv-events-group"/>',_grouptextscope='<div class="bv-events-group-text" />',_containerscope='<div class="bv-cards-container" />',grouptextword=$(grouptext).attr("data-text"),$(grouptext).text("")}function resetSelector(){var e=typeinst.getVal(),t=topicinst.getVal();if(e==[" "]&&t==[" "])return!1;typeinst.setVal([" "],!0),topicinst.setVal([" "],!0)}function resetCalendar(){1==isTypes||isTopics}function ungroupEvents(){$(".bv-events-group").each((function(){let e=$(this);e.find(".bv-events-group-text").remove(),e.find(".bv-card").unwrap().unwrap()})),eventlist.find(".bv-card").wrapAll(_containerscope);let e=eventlist.find(".bv-events-group-text"),t=eventlist.find(".bv-events-group");e.length<0&&t.prepend(_grouptextscope),eventlist.find(".bv-cards-container, .bv-events-group-text").wrapAll(_groupscope),e.show().text(""),eventlist.removeClass("events-grouped")}function groupEventsByMonth(e){eventlist.hasClass("events-grouped")&&ungroupEvents();let t=e.map((function(e,t){return $(t).attr("data-months")}));t=Array.from(new Set(t)),card.unwrap().unwrap();for(var n=0;n<t.length;n++){let s=e.filter((function(e,s){return $(s).attr("data-months")==t[n]}));s.wrapAll(_containerscope);let o=s.closest(".bv-cards-container");o.wrap(_groupscope);let a=o.closest(".bv-events-group");a.prepend(_grouptextscope);let l=a.find(".bv-events-group-text"),r="Events on "+t[n].replace(/(\d{3})/g,", $1");l.text(r)}e.closest(".bv-events-list-container").find(">.bv-events-group-text").hide(),eventlist.addClass("events-grouped")}function updateCardsBySelector(e,t){if(null!=e&&void 0!==t){console.log('in "updateCardsBySelector" selected:',e,"or",t);let n=""==e&&""==t,s=" "==e&&" "==t;if(console.log("empty=",s,"none=",n),s||n)$(grouptext).text(""),card.addClass("visible").show();else{eventlist.find(".bv-events-group-text").show().text("");let n=e.map((function(e){return","+e+","})),s=t.map((function(e){return","+e+","}));card.removeClass("visible").hide(),card.each((function(){let e=!1,t=!1,o=!0,a=$(this),l=a.attr("data-ev-type"),r=a.attr("data-ev-topic");if(0!=n.length)for(var i=0;i<n.length;i++){1==l.includes(n[i])&&(e=!0)}else e=!0;if(0!=s.length)for(i=0;i<s.length;i++){1==r.includes(s[i])&&(t=!0)}else e=!0;o=1==e||1==t,1==o&&a.addClass("visible").show()})),$(grouptext).text("")}}return!1}function updateCardsByCalendar(e){let t=!1,n=$(".bv-events-list-container").find(".bv-events-group-text");if(null!=e&&(t=null!=e.startDate&&null!=e.endDate),t){let t=moment.utc(e.startDate),s=moment.utc(e.endDate);card.removeClass("visible").hide();let o=card.filter((function(e,n){let o=moment.utc($(n).find(startDate).attr("data-time")),a=moment.utc($(n).find(endDate).attr("data-time")),l=moment(o).isBetween(t,s,null,"[]");moment(a).isBetween(t,s,null,"[]");return 1==l}));if(o.length>0)groupEventsByMonth(o),o.addClass("visible").show();else{eventlist.hasClass("events-grouped")&&ungroupEvents();eventlist.find(".bv-events-group");n=eventlist.find(".bv-events-group-text"),n.text(grouptextword).show()}}else card.addClass("visible").show(),n.text("")}function handleResult(e,t){switch(t){case"TYPE":key.type=e;break;case"TOPIC":key.topic=e;break;case"DATE":key.date=e}if(updateCardsBySelector(key.type,key.topic),null!=key.date){eventlist.hasClass("events-grouped")&&ungroupEvents(),null!=key.date.startDate&&null!=key.date.endDate&&updateCardsByCalendar(key.date)}}function initInputs(){const e=$("select"),t=$("input#EVENT_DATE");let n=t.width(),s={};mobiscroll.settings={theme:"bootstrap"},e.each((function(){var e=$(this),t=e.closest(".form-select"),n=t.width()-2,s=t.find(".form-text").text(),o=e.find("option").length>3?5:3,a=e.find("option").length<7?e.find("option").length:7,l=e.find("option:selected").text(),r=l,i=e.attr("id").split("_")[1];e.mobiscroll().select({closeOnOverlayTap:!1,showOverlay:!0,showLabel:!1,inputClass:"form-control form-control-lg",showOnFocus:!0,headerText:s,cssClass:"mbsc-outline",buttons:["set"],height:50,width:n,showScrollArrows:!0,placeholder:r,responsive:{xsmall:{display:"bottom",rows:o,touchUi:!0},medium:{display:"center",closeOnOverlayTap:!0,width:300},large:{scrollLock:!1,display:"bubble",buttons:[],headerText:!1,width:n,closeOnOverlayTap:!0,touchUi:!1,rows:a}},onInit:function(e,n){t.addClass("initialized"),handleResult(Object.values(n._tempSelected[0]),i,l)},onShow:function(e,n){t.addClass("active")},onChange:function(e,t){console.log("selector on change!"),console.log(t._tempValue,"inst_value=",t);let n=Object.values(t._tempSelected[0]);console.log("values=",n),""==n?t.setVal([""],!0):(n=n.filter(e=>""!=e),handleResult(n,i,l));let s=$("input#EVENT_DATE").mobiscroll("getInst");null!=s._value&&s.clear(),eventlist.hasClass("events-grouped")&&ungroupEvents(),console.log("values=",n)},onClose:function(e,n){t.removeClass("active")}})})),t.mobiscroll().range({controls:["calendar"],tabs:!1,showSelector:!1,headerText:!1,yearChange:!1,buttons:["clear","set"],clearText:"Reset",responsive:{xsmall:{display:"bottom"},medium:{display:"center"},large:{display:"bubble",maxWidth:n}},onInit:function(e,t){$(this).closest(".form-select").addClass("initialized")},onBeforeShow:function(e,t){let n=$("#EVENT_TYPE").mobiscroll("getInst"),s=$("#EVENT_TOPIC").mobiscroll("getInst");console.log(n,s);let o=n._wheelArray==[""]&&n._wheelArray==[""];console.log("noneselected=",o),o||(n.setVal([""],!0),s.setVal([""],!0))},onClear(e,t){var n=t.element.name.split("_")[1];s.startDate=null,s.endDate=null,handleResult(s,n)},onShow(e,t){$(this).closest(".form-select").addClass("active")},onClose:function(e,t){$(this).closest(".form-select").removeClass("active")},onSet:function(e,t){var n=t.element.name.split("_")[1];s.startDate=moment(t._startDate),s.endDate=moment(t._endDate),handleResult(s,n)}})}function app(){setUpItem(),initInputs(),formatingDate(card)}